<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>WinJS Contrib Source: winjscontrib.ui.flipsnap.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">WinJS Contrib</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#WinJSContrib">WinJSContrib</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Alerts.html">Alerts</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Bindings.html">Bindings</a>
						</li>
						
						<li>
							<a href="WinJSContrib.CrossPlatform.html">CrossPlatform</a>
						</li>
						
						<li>
							<a href="WinJSContrib.CrossPlatform.isMobile.html">isMobile</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Logging.html">Logging</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Logging.Appenders.html">Appenders</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.html">Search</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.html">Stemming</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.Op.html">Op</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.StopWords.html">StopWords</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Templates.html">Templates</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.html">UI</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.Animation.html">Animation</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataForm.Converters.html">Converters</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataSources.html">DataSources</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataSources.Grouping.html">Grouping</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Utils.html">Utils</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Utils.ValueParsers.html">ValueParsers</a>
						</li>
						
						<li>
							<a href="WinJSContrib.WinRT.html">WinRT</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="WinJSContrib.Logging.Appenders.ConsoleAppender.html">ConsoleAppender</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Logging.LoggerClass.html">LoggerClass</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Messenger.html">Messenger</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Messenger.SmartWorker.html">SmartWorker</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Index.html">Index</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.IndexGroup.html">IndexGroup</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.IndexWorkerProxy.html">IndexWorkerProxy</a>
						</li>
						
						<li>
							<a href="WinJSContrib.Search.Stemming.Pipeline.html">Pipeline</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.ChildViewFlyout.html">ChildViewFlyout</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataForm.html">DataForm</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.DataSources.DataSourceManager.html">DataSourceManager</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.EventTracker.html">EventTracker</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.ExtendedSplash.html">ExtendedSplash</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FlipSnap.html">FlipSnap</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FlipViewPager.html">FlipViewPager</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FluentDOM.html">FluentDOM</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.FlyoutPage.html">FlyoutPage</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.GlobalProgress.html">GlobalProgress</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.GridControl.html">GridControl</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.HubControl.html">HubControl</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.MediaTrigger.html">MediaTrigger</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.MultiPassItem.html">MultiPassItem</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.MultiPassRenderer.html">MultiPassRenderer</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.PageControlNavigator.html">PageControlNavigator</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.SemanticListViews.html">SemanticListViews</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UI.SmartListLayout.html">SmartListLayout</a>
						</li>
						
						<li>
							<a href="WinJSContrib.UPnP.UPnPDevice.html">UPnPDevice</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: winjscontrib.ui.flipsnap.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

(function () {
    'use strict';
    WinJS.Namespace.define("WinJSContrib.UI", {
        FlipSnap: WinJS.Class.mix(WinJS.Class.define(function ctor(element, options) {
            /** 
            * @class WinJSContrib.UI.FlipSnap
            * @classdesc
            * Control for managing snap scroll..
            * @param {HTMLElement} element DOM element containing the control
            * @param {Object} options
            */
            var ctrl = this;
            this.element = element || document.createElement('DIV');
            options = options || {};
            this.element.winControl = this;
            this.element.classList.add('win-disposable');
            this.element.classList.add('mcn-layout-ctrl');
            this.element.classList.add('flipsnapcontainer');
            this.list = document.createElement('DIV');
            this.list.classList.add('flipsnaplist');
            this.element.appendChild(this.list);
            this._navPromises = [];
            WinJS.UI.setOptions(this, options);
            ctrl._itemTemplate = options.itemTemplate;
            ctrl._itemMaxWidth = options.itemMaxWidth;
            if (!ctrl._itemMaxWidth) {
                ctrl._itemMaxWidth = 800;
            }
            ctrl._itemMaxMarge = options.itemMaxMarge;
            if (!ctrl._itemMaxMarge) {
                ctrl._itemMaxMarge = 10;
            }
            ctrl._itemClassName = options.itemClassName;
            ctrl._currentPosition = options.currentPosition
            if (!ctrl._currentPosition)
                ctrl._currentPosition = 0;
            ctrl.style = document.createElement('style');
            ctrl.listOnscrollbinded = ctrl.listOnscroll.bind(ctrl);
            ctrl.element.appendChild(ctrl.style);
            ctrl.list.addEventListener('scroll', ctrl.listOnscrollbinded);
            ctrl._itemListRendred = [];
            ctrl.updateLayout();
            ctrl._navBtns();

        },
        /**
        * @lends WinJSContrib.UI.FlipSnap.prototype
        */
        {
            _navBtns: function () {
                var ctrl = this;
                ctrl.next = document.createElement('button');
                ctrl.next.innerHTML = "&amp;#57571;"
                ctrl.next.className = "navbutton navbutton-right hide";
                ctrl.prev = document.createElement('button');
                ctrl.prev.innerHTML = "&amp;#57570;"
                ctrl.prev.className = "navbutton navbutton-left hide";
                ctrl.element.appendChild(ctrl.next);
                ctrl.element.appendChild(ctrl.prev);
                WinJSContrib.UI.tap(ctrl.next, function () {
                    ctrl.toNext();
                });
                WinJSContrib.UI.tap(ctrl.prev, function () {
                    ctrl.toPrev();
                });
            },
            listOnscroll: function () {
                var ctrl = this;
                if (ctrl._timeout)
                    clearTimeout(ctrl._timeout)
                ctrl._timeout = setTimeout(function () {
                    var newPosition = Math.round(ctrl.list.scrollLeft / (ctrl._itemw + ctrl._margeItem()));
                    if (ctrl._currentPosition !== newPosition) {
                        ctrl._currentPosition = newPosition;

                        var selectedItems = ctrl.list.querySelectorAll('.selected');
                        for (var i = 0, l = selectedItems.length; i &lt; l ; i++) {
                            selectedItems[i].classList.remove('selected');
                        }
                        ctrl._setStateNavBtns();
                        ctrl.list.children[ctrl._currentPosition].classList.add('selected');
                        ctrl.dispatchEvent("positionchanged", { currentPosition: ctrl._currentPosition });
                        ctrl.renderItems();
                        console.log(ctrl._currentPosition);
                    }
                }, 0);
            },
            _setStateNavBtns: function () {
                var ctrl = this;
                if (ctrl.canGoForward) {
                    ctrl.next.classList.remove('hide');
                }
                else {
                    ctrl.next.classList.add('hide');
                }
                if (ctrl.canGoBack) {
                    ctrl.prev.classList.remove('hide');
                }
                else {
                    ctrl.prev.classList.add('hide');
                }
            },
            toNext: function () {
                var ctrl = this;
                WinJS.Promise.join(ctrl._navPromises).then(function () {
                    ctrl._navPromises.push(ctrl._smooth_scroll_to(ctrl.list, (ctrl._itemw + ctrl._margeItem()) * (ctrl._currentPosition + 1), 300));
                }, function () { })
            },
            toPrev: function () {
                var ctrl = this;
                WinJS.Promise.join(ctrl._navPromises).then(function () {
                    var index = (ctrl._currentPosition - 1);
                    if (index &lt; 0)
                        index = 0
                    ctrl._navPromises.push(ctrl._smooth_scroll_to(ctrl.list, (ctrl._itemw + ctrl._margeItem()) * index, 300));
                }, function () { })
            },
            _smooth_scroll_to: function (element, target, duration) {
                target = Math.round(target);
                duration = Math.round(duration);
                if (duration &lt; 0) {
                    return Promise.reject("bad duration");
                }
                if (duration === 0) {
                    element.scrollLeft = target;
                    return Promise.resolve();
                }

                var start_time = Date.now();
                var end_time = start_time + duration;

                var start_top = element.scrollLeft;
                var distance = target - start_top;

                // based on http://en.wikipedia.org/wiki/Smoothstep
                var smooth_step = function (start, end, point) {
                    if (point &lt;= start) { return 0; }
                    if (point >= end) { return 1; }
                    var x = (point - start) / (end - start); // interpolation
                    return x * x * (3 - 2 * x);
                }

                return new WinJS.Promise(function (resolve, reject) {
                    // This is to keep track of where the element's scrollTop is
                    // supposed to be, based on what we're doing
                    try {
                        var previous_top = element.scrollLeft;

                        // This is like a think function from a game loop
                        var scroll_frame = function () {
                            if (element.scrollLeft != previous_top) {
                                resolve();
                                //reject("interrupted");
                                return;
                            }

                            // set the scrollTop for this frame
                            var now = Date.now();
                            var point = smooth_step(start_time, end_time, now);
                            var frameTop = Math.round(start_top + (distance * point));
                            element.scrollLeft = frameTop;

                            // check if we're done!
                            if (now >= end_time) {
                                resolve();
                                return;
                            }

                            // If we were supposed to scroll but didn't, then we
                            // probably hit the limit, so consider it done; not
                            // interrupted.
                            if (element.scrollLeft === previous_top
                                &amp;&amp; element.scrollLeft !== frameTop) {
                                resolve();
                                return;
                            }
                            previous_top = element.scrollLeft;

                            // schedule next frame for execution
                            requestAnimationFrame(scroll_frame);
                        }

                        // boostrap the animation process
                        requestAnimationFrame(scroll_frame);
                    }
                    catch (e) {
                        var sdf = "";
                    }
                });
            },
            /**
           * initilialize the item list of flipsnap control
           * @param {array} list - The item list.
           * @param {requestCallback} itemHandling - The callback that handles each item.
           */
            initList: function (list, itemHandling) {
                var ctrl = this;
                var template = ctrl._itemTemplate;
                if (template)
                    template = WinJSContrib.Utils.getTemplate(template);
                else {
                    throw "Where is the tempalte ?";
                }
                var promises = [];

                if (list &amp;&amp; list.length) {
                    ctrl._dataList = list;
                    if (list.length > 1) {
                        ctrl.next.classList.remove('hide');
                    }
                    list.forEach(function (fipitem, index) {
                        if (fipitem) {
                            fipitem.rendred = false;
                            var emptyElt = document.createElement('div');
                            if (index == 0) {
                                emptyElt.classList.add('flipsnapfistitem');
                            }
                            if (index == ctrl._currentPosition) {
                                emptyElt.classList.add('selected');
                            }
                            if (ctrl._itemClassName)
                                emptyElt.classList.add(ctrl._itemClassName);
                            emptyElt.classList.add('flipsnapitem')
                            ctrl.list.appendChild(emptyElt);

                            ctrl._itemListRendred.push(function () {
                                if (!fipitem.rendred) {
                                    fipitem.rendred = true;
                                    return template.render(fipitem, emptyElt).done(function (rendered) {
                                        var elt = rendered;
                                        itemHandling(elt, fipitem, index);
                                        if (index + 1 === list.length) {
                                            var lastitem = document.createElement('div');
                                            lastitem.className = "flipsnaplastitem";
                                            ctrl.list.appendChild(lastitem);
                                        }
                                    });
                                }
                                else {
                                    return WinJS.Promise.wrap({});
                                }
                            })
                        }

                    });
                }
                ctrl.renderItems().then(function () {
                    requestAnimationFrame(function () {
                        ctrl._setStateNavBtns();
                        ctrl.list.scrollLeft = (ctrl._itemw + ctrl._margeItem()) * (ctrl._currentPosition)
                        ctrl.dispatchEvent("positionchanged", { currentPosition: ctrl._currentPosition });
                    });
                });
            },
            renderItems: function () {
                var ctrl = this;
                var promises = [];
                if (ctrl._currentPosition == 0) {
                    promises.push(ctrl._itemListRendred[0]());
                    if (ctrl._itemListRendred.length > 1)
                        promises.push(ctrl._itemListRendred[1]());
                    if (ctrl._itemListRendred.length > 2)
                        promises.push(ctrl._itemListRendred[2]());
                }
                else {
                    if (ctrl._itemListRendred[ctrl._currentPosition])
                        promises.push(ctrl._itemListRendred[ctrl._currentPosition]());
                    if (ctrl._itemListRendred[ctrl._currentPosition - 1])
                        promises.push(ctrl._itemListRendred[ctrl._currentPosition - 1]());
                    if (ctrl._itemListRendred[ctrl._currentPosition - 2])
                        promises.push(ctrl._itemListRendred[ctrl._currentPosition - 2]());
                    if (ctrl._itemListRendred[ctrl._currentPosition + 1])
                        promises.push(ctrl._itemListRendred[ctrl._currentPosition + 1]());
                    if (ctrl._itemListRendred[ctrl._currentPosition + 2])
                        promises.push(ctrl._itemListRendred[ctrl._currentPosition + 2]());
                }
                return WinJS.Promise.join(promises);

            },
            /**
            * get or set the max width for an item of flipsnap control (default is 800px)
            * @member {Object}
            */
            itemTemplate: {
                get: function () {
                    return this._itemTemplate;
                },
                set: function (val) {
                    this._itemTemplate = val;
                }
            },
            /**
            * indicate if the flipsnap can go back
            * @member {boolean}
            */
            canGoBack: {
                get: function () {
                    if (this._currentPosition == 0)
                        return false;
                    else
                        return true
                }
            },
            /**
            * indicate if the flipsnap can go forward:
            * @member {boolean}
            */
            canGoForward: {
                get: function () {
                    return (this._currentPosition + 1 &lt; this.dataList.length)
                }
            },
            /**
            * @member {Array}
            */
            dataList: {
                get: function () {
                    if (this._dataList)
                        return this._dataList;
                    else
                        return [];
                }
            },
            /**
            * get or set the current position of flipsnap
            * @member {number}
            */
            currentPosition: {
                get: function () {
                    return this._currentPosition;
                },
                set: function (val) {
                    var ctrl = this;
                    ctrl._currentPosition = val;
                    ctrl._navPromises.push(ctrl._smooth_scroll_to(ctrl.list, (ctrl._itemw + ctrl._margeItem()) * (ctrl._currentPosition), 300));

                }
            },
            /**
            * get or set the max width for an item of flipsnap control (default is 800px)
            * @member {number}
            */
            itemMaxWidth: {
                get: function () {
                    return this._itemMaxWidth;
                },
                set: function (val) {
                    this._itemMaxWidth = val;
                }
            },
            _margeItem: function () {
                var ctrl = this;
                var margeitem = ctrl._itemMaxMarge;
                if (window.innerWidth &lt; 800) {
                    ctrl._itemw = window.innerWidth;
                    margeitem = 0;
                }
                return margeitem;
            },
            updateLayout: function () {
                var ctrl = this;
                var windowInnerWidth = window.innerWidth;
                ctrl._itemw = ctrl._itemMaxWidth;
                var marge = (windowInnerWidth - ctrl._itemMaxWidth) / 2;
                if (windowInnerWidth &lt; 800) {
                    marge = 0;
                }

                var margeitem = ctrl._margeItem();
                if (ctrl.currentPosition) {
                    ctrl.list.scrollLeft = (ctrl._itemw + margeitem) * ctrl.currentPosition;
                }
                ctrl.style.innerHTML = ".flipsnapcontainer .flipsnaplist{ -ms-scroll-snap-points-x: snapInterval(0%, " + (ctrl._itemw + margeitem) + "px); }" +
                    " .flipsnapcontainer  .flipsnaplist .flipsnapitem.flipsnapfistitem { margin-left:" + marge + "px } .flipsnaplist .flipsnapitem{ min-width:" + ctrl._itemw + "px;  width:" + ctrl._itemw + "px } " +
                    " .flipsnapcontainer .flipsnaplist .flipsnaplastitem { max-width:" + marge + "px ; min-width:" + marge + "px }" +
                    " .flipsnapcontainer .flipsnaplist .flipsnapitem {margin-right:" + margeitem + "px }"

            },
            dispose: function () {
                var ctrl = this;
                ctrl.list.removeEventListener('scroll', ctrl.listOnscroll);
                WinJS.Utilities.disposeSubTree(this.element);
                this.element = null;
            }
        }),
		WinJS.Utilities.eventMixin,
		WinJS.Utilities.createEventProperties("positionchanged"))
    });
})();</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					by MCNEXT
					<br />
					
					
		<span class="copyright">
		copyright MCNEXT
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Fri Apr 24 2015 14:31:56 GMT+0200 (Romance Daylight Time) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
